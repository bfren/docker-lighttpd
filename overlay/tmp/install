#!/bin/sh

set -euo pipefail
export BF_E=`basename ${0}`


#======================================================================================================================
# Add www user.
#======================================================================================================================

bf-adduser www


#======================================================================================================================
# Get Lighttpd version.
#======================================================================================================================

cd /tmp

VERSION=$(cat LIGHTTPD_BUILD)
bf-echo "Lighttpd version ${VERSION}."


#======================================================================================================================
# Install Lighttpd and dependencies.
#======================================================================================================================

bf-echo "Installing Lighttpd v${VERSION}..."
apk add --no-cache \
    lighttpd=${VERSION}
bf-done


#======================================================================================================================
# Cleanup.
#======================================================================================================================

bf-echo "Cleaning up default Lighttpd configuration and files."
rm -rf /var/www/*


#======================================================================================================================
# Create and link Lighttpd directories.
#======================================================================================================================

bf-echo "Creating Lighttpd directories."

mkdir -p /var/lib/lighttpd
mkdir -p /var/log/lighttpd

bf-echo "Linking /www to /var/www/localhost."
ln -s /www /var/www/localhost

bf-done
